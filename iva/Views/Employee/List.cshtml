@model iva.Models.employeeReqModel@{	ViewData["Title"] = "EmployeeList";	Layout = "~/Views/Shared/_Layout.cshtml";}@using System.Text.Json<div class="row">	<div class="col-10">		<div class="pagetitle">			<h1>Employee List</h1>			<nav>				<ol class="breadcrumb">					<li class="breadcrumb-item">Home</li>					<li class="breadcrumb-item active">Employee List</li>				</ol>			</nav>		</div>	</div>	<div class="col-2">. <button type='button' id="btnAddEmp" class='btnAddEmp btn btn-sm btn-light m-1  ' data-bs-toggle="modal" href='#employeeModalToggle'>Add</button></div></div><div id="tblEmployeeList" class="table-responsive"></div><div class="modal fade" id="employeeModal" role="dialog" tabindex="-1">	<div class="modal-dialog modal-dialog-centered">		<div class="modal-content">			<div class="modal-header">				<h5 class="modal-title" id="employeeModal">Add/Update Employee Details</h5>				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>			</div>			<div class="modal-body">				<div>					<div class="form-group">						<label class="control-label">Employee Id</label>						<input id="empId" class="form-control" readOnly="True" />					</div>					<div class="form-group">						<label class="control-label">Employee Name</label>						<input class="form-control" id="empName" />						<span class="text-danger" id="empNameError"></span>					</div>					<div class="form-group">						<label class="control-label">Employee Code</label>						<input class="form-control" id="empCode" />						<span class="text-danger" id="empCodeError"></span>					</div>					<div class="form-group">						<label class="control-label">Select Department</label>						<select id="drpDeptList" class="form-control">							<option value="">Loading departments...</option>						</select>						<span class="text-danger" id="drpDeptListError"></span>					</div>					<div class="form-group">						<label class="control-label">Position</label>						<input class="form-control" id="empPosition" />						<span class="text-danger" id="empPositionError"></span>					</div>					<div class="form-group">						<label class="control-label">Experience</label>						<input type="number" class="form-control" id="empExperience" />						<span class="text-danger" id="empExperienceError"></span>					</div>					<div class="form-group">						<label class="control-label">RfId</label>						<input class="form-control" id="empRfid" />						<span class="text-danger" id="empRfidError"></span>					</div>					<div class="form-group">						<label class="control-label">Joining Date</label>						<input class="form-control" type="date" id="fromDate" />					</div>					<div class="form-group">						<label class="control-label">Relieving Date</label>						<input class="form-control" type="date" id="toDate" />					</div>					<div>						<label class="control-label">Status</label>						<p>							<input type="radio" name="option" value="1" id="active"> Active							<input type="radio" name="option" value="0" id="deactive"> De-Active						</p>					</div>				</div>				<div id="empResult" class="text-danger" style="color:red;margin-top:10px"></div>			</div>			<div class="modal-footer">				<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>				<button type="button" id="btnSave" class="btn btn-primary">Save changes</button>			</div>		</div>	</div></div><div class="modal fade" id="deleteEmpModal" role="dialog" tabindex="-1">	<div class="modal-dialog modal-dialog-centered">		<div class="modal-content">			<div class="modal-header">				<h5 class="modal-title" id="deleteEmpModal">Employee</h5>				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>			</div>			<div class="modal-body">				<h6 class="modal-title">Are you sure delete employee?</h6>			</div>			<div class="modal-footer">				<button type="button" class="btn btn-danger" data-bs-dismiss="modal">No</button>				<button type="button" id="btnEmpDelete" class="btn btn-primary">Yes</button>			</div>		</div>	</div></div><div class="modal fade" id="deviceModal" role="dialog" tabindex="-1">	<div class="modal-dialog modal-dialog-centered">		<div class="modal-content">			<div class="modal-header">				<h5 class="modal-title" id="deviceModal">Add/Update Device</h5>				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>			</div>			<div class="modal-body">				<div class="checkbox-container" id="checkboxContainer"></div>			</div>			<div class="modal-footer">				<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>				<button type="button" id="btnMappingSave" class="btn btn-primary ">Save changes</button>			</div>		</div>	</div></div><script>	$(document).ready(function () {		// Load department into the dropdowns		$.ajax({			url: 'api/att/GetCompanyBasedDepartment',			type: 'GET',			dataType: 'json',			success: function (response) {				console.log("Department Loaded: ", response);				if (response && response.length > 0) {					$('#drpDeptList').empty().append('<option value="">Select a department</option>');					// Populate dropdown with device options					$.each(response, function (index, department) {						$('#drpDeptList').append(							$('<option></option>').attr('value', department.departmentName).text(department.departmentName)						);					});				} else {					$('#drpDeptList').html('<option value="">No departments available</option>');				}			},			error: function (xhr, status, error) {				console.error("Error loading department: ", xhr.responseText);				$('#drpDeptList').html('<option value="">Failed to load Departments</option>');			}		});		var empId = 0;		function generateTable(list) {			var $table = $("<table id='foo-row-toggler' class='table table-borderless datatable'>");			$table.append("<thead><tr><th>Id.</th><th>EmployeeName</th><th>Code</th><th>Department</th><th>RfId</th><th>Status</th><th>Action</th></tr></thead>");			var $tbody = $("<tbody>");			$.each(list, function (i, val) {				var add, mod, last, type;				var isActive;				if (val.isActive === true) {					isActive = "active";				} else {					isActive = "deactive";				}				var statusBadge = (isActive === "active") ? "<span class='badge bg-success'>active</span>" : "<span class='badge bg-danger'>in active</span>";				var $row = "<tr><td>" + val.employeeId + "</td><td>" + val.employeeName + "</td><td>" + val.employeeCode + "</td><td>" + val.department + "</td><td>" + val.rfid + "</td><td>" + statusBadge + "</td><td><button type='button' class='btnUpdate btn btn-sm btn-info m-1'>Update</button><button type='button' class='btnMapping btn btn-sm btn-success m-1 ' style='display: none;'>Mapping Devices</button><button type='button' class='btnDelete btn btn-sm btn-danger m-1' >Delete</button></td></tr>";				$tbody.append($row);			});			$tbody.append("</tbody>");			$table.append($tbody);			$table.append("</table>");			$("#tblEmployeeList").html($table);			$("#foo-row-toggler").DataTable();		}		var list = JSON.parse('@Html.Raw(Json.Serialize(@ViewBag.employeeList))');		console.log(list, '1lit');		generateTable(list);		$("#btnAddEmp").on("click", function () {			$(".text-danger").text("");			$("#employeeModal").modal("show");			$('#empId').val(empId);			$('#empName').val('');			$('#empCode').val('');			$('#drpDeptList').val('');			$('#empPosition').val('');			$('#empExperience').val('');			$('#empRfid').val('');			$('#active').prop('checked', true);			$('#fromDate').val('');			$('#toDate').val('');		});		function validateForm() {			let isValid = true;			$(".text-danger").text(""); // Clear previous errors			if (!$('#empId').val()) {				$('#empIdError').text("Employee Id is required.");				isValid = false;			}			if (!$('#empName').val()) {				$('#empNameError').text("Employee Name is required.");				isValid = false;			} else if (!/^[a-zA-Z0-9\s]+$/.test($('#empName').val())) {				$('#empNameError').text("Only letters and numbers are allowed.");				isValid = false;			}			if (!$('#empCode').val()) {				$('#empCodeError').text("Employee Code is required.");				isValid = false;			} else if (!/^[a-zA-Z0-9\s]+$/.test($('#empCode').val())) {				$('#empCodeError').text("Only letters and numbers are allowed.");				isValid = false;			}			if (!$('#drpDeptList').val()) {				$('#drpDeptListError').text("Department is required.");				isValid = false;			}			if (!$('#empPosition').val()) {				$('#empPositionError').text("Position is required.");				isValid = false;			} else if (!/^[a-zA-Z\s]+$/.test($('#empPosition').val())) {				$('#empPositionError').text("Only letters are allowed.");				isValid = false;			}			if (!$('#empExperience').val()) {				$('#empExperienceError').text("Experience is required.");				isValid = false;			} else if (!/^\d{1,2}$/.test($('#empExperience').val())) {				$('#empExperienceError').text("Only numbers up to 2 digits are allowed.");				isValid = false;			}			if (!$('#empRfid').val()) {				$('#empRfidError').text("RfId is required.");				isValid = false;			} else if (!/^[a-zA-Z0-9\s]+$/.test($('#empRfid').val())) {				$('#empRfidError').text("Only letters and numbers are allowed.");				isValid = false;			}			return isValid;		}		$("#btnSave").on("click", function () {			var checkedValue = $('input[type=radio][name=option]:checked').val();			var status = false			if (checkedValue == 1) {				status = true;			}			if (!validateForm()) {				return;			}			var empDetail = {				employeeId: $('#empId').val(),				employeeName: $('#empName').val(),				employeeCode: $('#empCode').val(),				department: $('#drpDeptList').val(),				position: $('#empPosition').val(),				experience: $('#empExperience').val(),				rfid: $('#empRfid').val(),				from_date: $('#fromDate').val(),				to_date: $('#toDate').val(),				IsActive: status			};			console.log(empDetail);			$.ajax({				context: document.body,				data: { obj: empDetail },				success: function (data) {					console.log(data);					if (data.success === true) {						Swal.fire({							title: "Information",							text: data.message,							icon: "success"						});						location.reload();					}					else if (data.success === false) {						Swal.fire({							title: "Error!",							text: data.message,							icon: "warning"						});					}				},				dataType: "json",				type: "POST",				url: "att/UpdateEmployee"			});		});		$("#btnMappingSave,#btnMappingSaveModal").on("click", function () {			console.log(empId)			$("#btnMappingSave").html("Please wait...");			var chkValues = [];			$('.dynamicCheckbox:checked').each(function () {				chkValues.push({ deviceId: $(this).val() });			});			console.log(chkValues)			$.ajax({				context: document.body,				data: { employeeId: empId, dList: chkValues },				error: function (e) {					swal(e.Message, "", "error");				},				success: function (data) {					$("#btnMappingSave").html("Save changes");					console.log(data);					if (data.success === true) {						$("#deviceModal").modal("hide");						Swal.fire({							title: "Information!",							text: "Device Mapped Succesfully!",							icon: "success"						});					}					else if (data.success === false) {						Swal.fire({							title: "Error!",							text: data.message,							icon: "warning"						});					}				},				dataType: "json",				type: "POST",				url: "att/MappingDevice"			});		});		$("#btnEmpDelete").on("click", function () {			$.ajax({				context: document.body,				data: { employeeId: empId },				error: function (e) { swal(e.Message, "", "error"); },				success: function (data) {					console.log(data);					if (data.success === true) {						Swal.fire({							title: "Information",							text: data.message,							icon: "success"						});						location.reload();					}					else if (data.success === false) {						Swal.fire({							title: "Error!",							text: data.message,							icon: "warning"						});					}				},				dataType: "json",				type: "POST",				url: "att/DeleteEmployee"			});		});		$('#tblEmployeeList tbody').on('click', '.btnUpdate', function () {			$(".text-danger").text("");			var empId = $("#tblEmployeeList table tbody tr:nth-child(" + this.closest("tr").rowIndex + ") td:nth-child(1)").html();			function formatDate(dateTimeString) {				return dateTimeString.split('T')[0];			}			$.ajax({				context: document.body,				data: { employeeId: empId },				error: function (e) { swal(e.Message, "", "error"); },				success: function (data) {					if (data.success === true) {						empId = data.list.employeeId						$('#empId').val(empId);						$('#empName').val(data.list.employeeName);						$('#empCode').val(data.list.employeeCode);						$('#drpDeptList').val(data.list.department);						$('#empPosition').val(data.list.position);						$('#empExperience').val(data.list.experience)						$('#empRfid').val(data.list.rfid);						$("#employeeModal").modal("show");						$('#fromDate').val(formatDate(data.list.from_date));						$('#toDate').val(formatDate(data.list.to_date));						if (data.list.isActive) {							$('#active').prop('checked', true);						} else {							$('#deactive').prop('checked', true);						}					}					else if (data.success === false) {						Swal.fire({							title: "Error!",							text: data.message,							icon: "error"						});					}				},				dataType: "json",				type: "POST",				url: "att/GetEmployeeDetail"			});		});		$('#tblEmployeeList tbody').on('click', '.btnMapping', function () {			var Id = $("#tblEmployeeList table tbody tr:nth-child(" + this.closest("tr").rowIndex + ") td:nth-child(1)").html();			empId = Id;			$.ajax({				context: document.body,				data: { employeeId: Id },				error: function (e) { swal(e.Message, "", "error"); },				success: function (data) {					console.log(data)					if (data.success === true) {						console.log(data.list)						items = data.list;						$('#checkboxContainer').empty();						$.each(items, function (index, item) {							var checkbox = $('<input />', {								type: 'checkbox',								class: 'dynamicCheckbox',								id: 'checkbox' + item.id,								value: item.id,								checked: item.status							});							var label = $('<label />', {								'for': 'checkbox' + item.id,								text: item.name							});							$('#checkboxContainer').append(checkbox).append(label).append('<br>');						});						$("#deviceModal").modal("show");					}					else if (data.success === false) {						Swal.fire({							title: "Error!",							text: data.message,							icon: "error"						});					}				},				dataType: "json",				type: "POST",				url: "att/GetDeviceList"			});		});		$('#tblEmployeeList tbody').on('click', '.btnDelete', function () {			var Id = $("#tblEmployeeList table tbody tr:nth-child(" + this.closest("tr").rowIndex + ") td:nth-child(1)").html();			empId = Id;			$("#deleteEmpModal").modal("show");		});	});</script>